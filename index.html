<html>
  <head>
    <title></title>
    <meta charset="utf-8" />
    <style>
      body {
        position: absolute;
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
        /* overflow: hidden; */
      }
      .prompt {
        width: 100%;
        padding: 0;
        margin: 0;
      }
      .output {
        padding: 0;
        margin: 0;
      }
      /*
      #terminal {
        display: block;
        position: relative;
        width: 100%;
        height: 100%;
      }
      */
    </style>
    <!-- link rel="stylesheet" href="http://terminal.jcubic.pl/css/jquery.terminal.css" / -->
    <!-- script src="http://code.jquery.com/jquery.min.js"></script -->
    <!-- script src="http://terminal.jcubic.pl/js/jquery.terminal-0.8.8.min.js"></script -->
    <script src="jsh.js"></script>
  </head>
  <body>
    <script>
      var terminal = document.createElement("div");
      document.body.appendChild(terminal);
      jsh.loop(function () {
        return jsh.then(function () {
          var input = document.createElement("textarea");
          input.className = "prompt";
          input.setAttribute("rows", 1);
          setTimeout(function () { input.focus(); });
          terminal.appendChild(input);
          return new Promise(function (done) {
            input.addEventListener("keypress", function f(ev) {
              if (!ev.shiftKey && (ev.key === "Enter" || ev.keyCode === 10)) {
                if (input.value === "") { return ev.preventDefault(); }
                input.removeEventListener("keypress", f);
                input.disabled = true;
                done(input.value);
              }
            });
          });
        }).then(function (inputValue) {
          var output = document.createElement("pre");
          terminal.appendChild(output);
          return jsh.then(function () {
            return jsh.value(window.eval(inputValue || "undefined")).asText();
          }).then(function (eVal) {
            output.textContent = eVal;
          }).catch(function (e) {
            output.textContent = e;
          });
        });
      });

      function dir(obj) {
        var k, s = "";
        for (k in obj) {
          s += k + ": " + typeof obj[k] + "\n";
        }
        return s;
      }

      // var terminal;
      // jQuery(function($, undefined) {
      //   $('#terminal').terminal(function(command, term) {
      //     terminal = term;
      //     if (command !== '') {
      //       try {
      //         var result = window.eval(command);
      //         if (result !== undefined) {
      //           term.echo(new String(result));
      //         }
      //       } catch(e) {
      //         term.error(new String(e));
      //       }
      //     } else {
      //       term.echo('');
      //     }
      //   }, {
      //     greetings: "Javascript Interpreter",
      //     name: "js",
      //     height: window.innerHeight - 30,
      //     prompt: "js> "
      //   });
      // });
    </script>
  </body>
</html>
