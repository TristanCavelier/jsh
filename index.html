<html>
  <head>
    <title></title>
    <meta charset="utf-8" />
    <style>
      body {
        position: absolute;
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;

        color: white;
        background-color: black;
      }
      .prompt {
        width: 100%;
        border: grey solid 1px;

        color: white;
        background-color: black;
      }
      .output {
      }
    </style>
    <script src="jsh.js"></script>
  </head>
  <body>
    <script>
      var terminal = document.createElement("div");
      document.body.appendChild(terminal);
      jsh.loop(function () {
        return jsh.then(function () {
          var input = document.createElement("textarea");
          input.className = "prompt";
          input.placeholder = "> Type your command here";
          input.setAttribute("rows", 1);
          setTimeout(function () { input.focus(); });
          terminal.appendChild(input);
          return new Promise(function (done) {
            input.addEventListener("keypress", function f(ev) {
              if (ev.key === "Enter" || ev.keyCode === 13) {
                if (ev.shiftKey) {
                  input.setAttribute("rows", input.value.split("\n").length + 1);
                } else {
                  input.setAttribute("rows", input.value.split("\n").length);
                  if (input.value === "") { return ev.preventDefault(); }
                  input.removeEventListener("keypress", f);
                  input.disabled = true;
                  done(input.value);
                }
              }
            });
          });
        }).then(function (inputValue) {
          var output = document.createElement("pre");
          terminal.appendChild(output);
          return jsh.then(function () {
            return jsh.value(window.eval(inputValue || "undefined")).asText();
          }).then(function (eVal) {
            output.textContent = eVal;
          }).catch(function (e) {
            output.textContent = e;
          });
        });
      });

      function dir(obj) {
        var k, s = "";
        for (k in obj) {
          s += k + ": " + typeof obj[k] + "\n";
        }
        return s;
      }
    </script>
  </body>
</html>
